// 1. 品牌圖片配置
const BRAND_CONFIG = {
    "agnès b.": "https://www.bespoke-wedding.com/sites/default/files/禮卡/Agnès%20b.png",
    "聖安娜": "https://www.bespoke-wedding.com/sites/default/files/禮卡/SAINT%20%20HIGH.webp",
    "GODIVA": "https://www.bespoke-wedding.com/sites/default/files/禮卡/GODIVA.png",
    "東海堂": "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/tong.png",
    "太興": "https://www.bespoke-wedding.com/sites/default/files/禮卡/太興.jpeg",
    "鴻福堂": "https://www.bespoke-wedding.com/sites/default/files/禮卡/HungFukTong.webp",
    "Lady M": "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/Sugarfina%20(2).png",
    "L.M.D.C": "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/lmdc.png",
    "華御結": "https://www.bespoke-wedding.com/sites/default/files/禮卡/HM%20Logo%20Wide-01.png",
    "甜姨姨": "https://www.bespoke-wedding.com/sites/default/files/禮卡/auntie%20Sweet.webp",
    "永樂": "https://www.bespoke-wedding.com/sites/default/files/禮卡/winglok_LOGO.webp",
    "LE CREUSET": "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/Copy%20of%20禮卡11.png",
    "奇華": "https://www.bespoke-wedding.com/sites/default/files/KWLOGO.png"
};

// 2. 產品資訊 (根據最新資料更新)
const PRODUCT_DEFS = [
    // agnès b. (85折)
    { brand: "agnès b.", name: "agnès b. $50禮券", sku: "20081", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/agnes50.png", tiers: [{q:10, d:0.85}] },
    { brand: "agnès b.", name: "agnès b. $80禮券", sku: "200082", orig: 80, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/agnes80.png", tiers: [{q:10, d:0.85}] },
    { brand: "agnès b.", name: "agnès b. $100禮券", sku: "20083", orig: 100, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/agnes100.png", tiers: [{q:10, d:0.85}] },
    
    // 聖安娜 (7折)
    { brand: "聖安娜", name: "聖安娜 $25禮券", sku: "10127", orig: 25, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/ST25.png", tiers: [{q:10, d:0.7}] },
    { brand: "聖安娜", name: "聖安娜 $50禮券", sku: "10209", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/ST50.png", tiers: [{q:10, d:0.7}] },
    
    // GODIVA (85折)
    { brand: "GODIVA", name: "GODIVA $50 (粉紅封套)", sku: "10344", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/godiva-p.png", tiers: [{q:10, d:0.85}] },
    { brand: "GODIVA", name: "GODIVA $50 (深啡封套)", sku: "10110", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/godiva-b.png", tiers: [{q:10, d:0.85}] },
    { brand: "GODIVA", name: "GODIVA 軟雪糕及飲品禮券", sku: "10116", orig: 59, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/godiva-fnb.png", tiers: [{q:10, d:0.85}] },
    { brand: "GODIVA", name: "GODIVA $100禮券", sku: "GODIVA-100", orig: 100, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/godiva-r.png", tiers: [{q:10, d:0.85}] },

    // 東海堂 (79折)
    { brand: "東海堂", name: "東海堂 $50 (花慶版)", sku: "10274", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/arm_f_50.png", tiers: [{q:10, d:0.79}] },
    { brand: "東海堂", name: "東海堂 $50 (經典版)", sku: "10107", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/ARM_O_50.png", tiers: [{q:10, d:0.79}] },
    { brand: "東海堂", name: "東海堂 $25", sku: "10275", orig: 25, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/arm_G_25.png", tiers: [{q:10, d:0.792}] },

    // 太興 (88折)
    { brand: "太興", name: "太興 $50金豬禮券", sku: "10419", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/taihing1.png", tiers: [{q:10, d:0.88}] },

    // 鴻福堂 (6折/階梯)
    { brand: "鴻福堂", name: "鴻福堂 $50 (囍)", sku: "10278", orig: 60, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/HFT_HEI.png", tiers: [{q:10, d:0.6}] },
    { brand: "鴻福堂", name: "自家湯套票(1套10張)", sku: "HFT-汤", orig: 600, min: 1, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/自家湯.png", tiers: [{q:1, d:0.658}] },
    { brand: "鴻福堂", name: "自家豬腳薑醋禮券", sku: "HFT-姜", orig: 68, min: 1, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/HFT_PIG.png", tiers: [{q:1, d:0.676}] },

    // Lady M (層遞式)
    { brand: "Lady M", name: "Lady M $80", sku: "10437", orig: 80, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/Ladym80_.png", tiers: [{q:50, d:0.8}, {q:10, d:1}] },
    { brand: "Lady M", name: "Lady M $150", sku: "10430", orig: 150, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡.png", tiers: [{q:50, d:0.8}, {q:10, d:1}] },

    // L.M.D.C (層遞式)
    { brand: "L.M.D.C", name: "L.M.D.C $50禮券", sku: "10376", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/LMDC50.png", tiers: [{q:50, d:0.84}, {q:10, d:0.88}] },
    { brand: "L.M.D.C", name: "L.M.D.C $100禮券", sku: "10380", orig: 100, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/lmdc100.png", tiers: [{q:50, d:0.85}, {q:10, d:0.88}] },

    // 華御結 (層遞式)
    { brand: "華御結", name: "華御結 $25禮券", sku: "10446", orig: 25, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/hana25.png", tiers: [{q:50, d:0.85}, {q:10, d:0.88}] },
    { brand: "華御結", name: "華御結 $50禮券", sku: "10444", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/hana50.png", tiers: [{q:50, d:0.85}, {q:10, d:0.88}] },

    // LE CREUSET (6折)
    { brand: "LE CREUSET", name: "LE CREUSET $100禮券", sku: "10290", orig: 100, min: 1, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/le%20100.webp", tiers: [{q:1, d:0.6}] },
    { brand: "LE CREUSET", name: "LE CREUSET $1000禮券", sku: "10294", orig: 1000, min: 1, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/le1000.webp", tiers: [{q:1, d:0.6}] },

    // 奇華 (84折)
    { brand: "奇華", name: "奇華 $50禮券", sku: "10461", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/50.png", tiers: [{q:10, d:0.8}] },
    { brand: "奇華", name: "奇華 金盈喜禮券", sku: "10463", orig: 83.3, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/金盈.png", tiers: [{q:10, d:0.84}] }
];

// 核心組件片段
const PreviewModal = () => {
    return React.createElement('div', { className: "fixed inset-0 bg-black/60 z-50 flex items-end" },
        React.createElement('div', { className: "bg-white w-full max-w-md mx-auto p-8 rounded-t-[3rem] animate-up shadow-2xl" },
            React.createElement('h3', { className: "text-xl font-black mb-6" }, "核對訂單"),
            
            // 產品列表
            React.createElement('div', { className: "max-h-60 overflow-y-auto mb-6 space-y-4 hide-scrollbar" },
                cartItems.map(item => React.createElement('div', { key: item.sku, className: "flex justify-between text-sm" },
                    React.createElement('div', null, 
                        React.createElement('div', { className: "font-bold" }, item.name),
                        React.createElement('div', { className: "text-xs text-gray-400" }, `$${item.currentPrice} x ${item.qty}`)
                    ),
                    React.createElement('span', { className: "font-black" }, `$${(item.currentPrice * item.qty).toLocaleString()}`)
                ))
            ),

            // 合計金額部分 (補回)
            React.createElement('div', { className: "border-t border-dashed pt-4 mb-4" },
                React.createElement('div', { className: "flex justify-between items-center mb-2" },
                    React.createElement('span', { className: "text-gray-500 font-bold" }, "合計估算金額:"),
                    React.createElement('span', { className: "text-2xl font-black text-rose-500" }, `HK$ ${totalPrice.toLocaleString()}`)
                ),
                // 提示字句 (補回)
                React.createElement('p', { className: "text-[11px] text-gray-400 bg-gray-50 p-3 rounded-xl leading-relaxed" }, 
                    "⚠️ 此價錢為暫定價格，於付款時收銀同事將提供相應的專屬優惠。最終價格以門市結帳為準。"
                )
            ),

            React.createElement('button', { onClick: handleConfirm, className: "w-full bg-rose-500 text-white py-4 rounded-2xl font-black mb-2" }, "確認訂單並生成 QR"),
            React.createElement('button', { onClick: () => setShowPreview(false), className: "w-full py-2 text-gray-400 text-sm" }, "返回修改數量")
        )
    );
};
