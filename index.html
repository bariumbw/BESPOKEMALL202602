<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bespoke Mall | Êô∫ËÉΩË®ÇË≥ºÁ≥ªÁµ±</title>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+HK:wght@300;400;500;700;900&display=swap');
        body { font-family: 'Noto Sans HK', sans-serif; -webkit-tap-highlight-color: transparent; overscroll-behavior-y: contain; }
        .brand-card { transition: all 0.2s; border-radius: 2rem; cursor: pointer; border: 1px solid #f1f5f9; }
        .product-card { transition: all 0.2s; border-radius: 1.5rem; }
        .animate-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .tab-active { color: #f43f5e; border-bottom: 3px solid #f43f5e; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .barcode-container svg { width: 100% !important; height: auto !important; }
        
        /* Á¶ÅÁî®ÊåâÈàïÊ®£Âºè */
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
    </style>
</head>
<body class="bg-gray-50 text-slate-900">
    <div id="root"></div>

    <script>
        const { useState, useMemo, useRef, useEffect } = React;

        // --- 1. Â∑≤Êõ¥Êñ∞ÁÇ∫ÊÇ®ÊúÄÊñ∞ÁöÑÁ∂≤ÂùÄ ---
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwx9qCf1N4QxA-4jXTLEjSr3Bgp5-AARpf7MHA_E9SA6xoyZre4grbXyIDtAhm6LpItLg/exec";

        const BRAND_CONFIG = {
            "agn√®s b.": "https://www.bespoke-wedding.com/sites/default/files/%E7%A6%AE%E5%8D%A1/Agne%CC%80s%20b.png",
            "ËÅñÂÆâÂ®ú": "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/SAINT%20%20HIGH.webp",
            "GODIVA": "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/GODIVA.png",
            "Êù±Êµ∑Â†Ç": "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/tong.png",
            "Â§™Ëàà": "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Â§™Ëàà.jpeg",
            "È¥ªÁ¶èÂ†Ç": "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/HungFukTong.webp",
            "Lady M": "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/Sugarfina%20(2).png",
            "L.M.D.C": "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/lmdc.png",
            "ËèØÂæ°Áµê": "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/HM%20Logo%20Wide-01.png",
            "ÁîúÂß®Âß®": "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/auntie%20Sweet.webp",
            "Ê∞∏Ê®Ç": "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/winglok_LOGO.webp",
            "LE CREUSET": "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/Copy%20of%20Á¶ÆÂç°11.png",
            "Â•áËèØ": "https://www.bespoke-wedding.com/sites/default/files/KWLOGO.png",
            "Á≥ïÈªûÊôÇÂÖâ": "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á≥ïÈªûÊôÇÂÖâ.webp",
            "Bonne Maman": "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Bonne%20Maman_%20.png"
        };

        const PRODUCT_DEFS = [
            { category: "Gift Card", brand: "agn√®s b.", name: "agn√®s b. $50Á¶ÆÂà∏", sku: "20081", expiry: "2026-12-31", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/agnes50.png", tiers: [{q:10, d:0.85}] },
            { category: "Gift Card", brand: "agn√®s b.", name: "agn√®s b. $80Á¶ÆÂà∏", sku: "200082", expiry: "2026-12-31", orig: 80, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/agnes80.png", tiers: [{q:10, d:0.85}] },
            { category: "Gift Card", brand: "agn√®s b.", name: "agn√®s b. $100Á¶ÆÂà∏", sku: "20083", expiry: "2026-12-31", orig: 100, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/agnes100.png", tiers: [{q:10, d:0.85}] },
            { category: "Gift Card", brand: "ËÅñÂÆâÂ®ú", name: "ËÅñÂÆâÂ®ú $25Á¶ÆÂà∏", sku: "10127", expiry: "2026-12-31", orig: 25, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/ST25.png", tiers: [{q:10, d:0.7}] },
            { category: "Gift Card", brand: "ËÅñÂÆâÂ®ú", name: "ËÅñÂÆâÂ®ú $50Á¶ÆÂà∏", sku: "10209", expiry: "2026-12-31", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/ST50.png", tiers: [{q:10, d:0.7}] },
            { category: "Gift Card", brand: "GODIVA", name: "GODIVA $50 (Á≤âÁ¥ÖÂ∞ÅÂ•ó)", sku: "10344", expiry: "2026-12-31", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/godiva-p.png", tiers: [{q:10, d:0.85}] },
            { category: "Gift Card", brand: "GODIVA", name: "GODIVA $50 (Ê∑±Âï°Â∞ÅÂ•ó)", sku: "10110", expiry: "2026-12-31", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/godiva-b.png", tiers: [{q:10, d:0.85}] },
            { category: "Gift Card", brand: "GODIVA", name: "GODIVA ËªüÈõ™Á≥ïÂèäÈ£≤ÂìÅÁ¶ÆÂà∏", sku: "10116", expiry: "2026-08-31", orig: 59, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/godiva-fnb.png", tiers: [{q:10, d:0.8508}] },
            { category: "Gift Card", brand: "GODIVA", name: "GODIVA $100Á¶ÆÂà∏", sku: "10111", expiry: "2026-12-31", orig: 100, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/godiva-r.png", tiers: [{q:10, d:0.85}] },
            { category: "Gift Card", brand: "Êù±Êµ∑Â†Ç", name: "Êù±Êµ∑Â†Ç $50 (Ëä±ÊÖ∂Áâà)", sku: "10274", expiry: "2026-12-31", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/arm_f_50.png", tiers: [{q:10, d:0.79}] },
            { category: "Gift Card", brand: "Êù±Êµ∑Â†Ç", name: "Êù±Êµ∑Â†Ç $50 (Á∂ìÂÖ∏Áâà)", sku: "10107", expiry: "2026-12-31", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/ARM_O_50.png", tiers: [{q:10, d:0.79}] },
            { category: "Gift Card", brand: "Êù±Êµ∑Â†Ç", name: "Êù±Êµ∑Â†Ç $25", sku: "10275", expiry: "2026-12-31", orig: 25, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/arm_G_25.png", tiers: [{q:10, d:0.792}] },
            { category: "Gift Card", brand: "Â§™Ëàà", name: "Â§™Ëàà $50ÈáëË±¨Á¶ÆÂà∏", sku: "10419", expiry: "2026-12-31", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/taihing1.png", tiers: [{q:10, d:0.88}] },
            { category: "Gift Card", brand: "È¥ªÁ¶èÂ†Ç", name: "È¥ªÁ¶èÂ†Ç $50 (Âõç)", sku: "10278", expiry: "2026-12-31", orig: 60, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/HFT_HEI.png", tiers: [{q:10, d:0.6}] },
            { category: "Gift Card", brand: "È¥ªÁ¶èÂ†Ç", name: "È¥ªÁ¶èÂ†Ç $50 (Á≤âÁ¥Ö)", sku: "10279", expiry: "2026-12-31", orig: 60, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/HKT_P.png", tiers: [{q:10, d:0.6}] },
            { category: "Gift Card", brand: "È¥ªÁ¶èÂ†Ç", name: "Ëá™ÂÆ∂ÊπØÂ•óÁ•®(10Âºµ)", sku: "HFT-001", expiry: "2026-12-31", orig: 600, min: 1, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/Ëá™ÂÆ∂ÊπØ.png", tiers: [{q:1, d:0.6583}] },
            { category: "Gift Card", brand: "È¥ªÁ¶èÂ†Ç", name: "Ëá™ÂÆ∂Ê∂ºËå∂Â•óÁ•®(10Âºµ)", sku: "HFT-002", expiry: "2026-12-31", orig: 600, min: 1, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/Ê∂ºËå∂.png", tiers: [{q:1, d:0.6583}] },
            { category: "Gift Card", brand: "È¥ªÁ¶èÂ†Ç", name: "Ëó•Ë£ΩÈæúËãìËÜèÂ•óÁ•®(10Âºµ)", sku: "HFT-003", expiry: "2026-12-31", orig: 600, min: 1, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/0ËÜè.png", tiers: [{q:1, d:0.6583}] },
            { category: "Gift Card", brand: "È¥ªÁ¶èÂ†Ç", name: "Ëá™ÂÆ∂Ë±¨ËÖ≥ËñëÈÜãÁ¶ÆÂà∏", sku: "HFT-007", expiry: "2026-12-31", orig: 60, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/HFT_PIG.png", tiers: [{q:10, d:0.766}] },
            { category: "Gift Card", brand: "Lady M", name: "Lady M US$80", sku: "10437-10443", expiry: "2026-12-31", orig: 80, min: 1, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/Ladym80_.png", tiers: [{q:1, d:1.0}, {q:50, d:0.8}] },
            { category: "Gift Card", brand: "Lady M", name: "Lady M US$150", sku: "10430-10436", expiry: "2026-12-31", orig: 150, min: 1, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°.png", tiers: [{q:1, d:1.0}, {q:50, d:0.8}] },
            { category: "Gift Card", brand: "L.M.D.C", name: "L.M.D.C $50Á¶ÆÂà∏", sku: "10376/10377", expiry: "2026-12-31", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/LMDC50.png", tiers: [{q:10, d:0.88}, {q:50, d:0.84}] },
            { category: "Gift Card", brand: "L.M.D.C", name: "L.M.D.C $100Á¶ÆÂà∏", sku: "10380/10378", expiry: "2026-12-31", orig: 100, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/lmdc100.png", tiers: [{q:10, d:0.88}, {q:50, d:0.85}] },
            { category: "Gift Card", brand: "L.M.D.C", name: "L.M.D.C $500Á¶ÆÂà∏", sku: "10381/10379", expiry: "2026-12-31", orig: 500, min: 1, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/LMDC500.png", tiers: [{q:1, d:0.88}, {q:10, d:0.85}] },
            { category: "Gift Card", brand: "ËèØÂæ°Áµê", name: "ËèØÂæ°Áµê $25Á¶ÆÂà∏", sku: "10446/10447", expiry: "2026-12-31", orig: 25, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/hana25.png", tiers: [{q:10, d:0.88}, {q:50, d:0.85}] },
            { category: "Gift Card", brand: "ËèØÂæ°Áµê", name: "ËèØÂæ°Áµê $50Á¶ÆÂà∏", sku: "10444/10445", expiry: "2026-12-31", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/hana50.png", tiers: [{q:10, d:0.88}, {q:50, d:0.85}] },
            { category: "Gift Card", brand: "ÁîúÂß®Âß®", name: "ÁîúÂß®Âß® (Á¥ÖËâ≤Â©öÊÖ∂) $50", sku: "10270/10271/10272", expiry: "2026-12-31", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/AS_R.png", tiers: [{q:10, d:0.85}, {q:50, d:0.75}, {q:100, d:0.7}] },
            { category: "Gift Card", brand: "ÁîúÂß®Âß®", name: "ÁîúÂß®Âß® (Ê∑°ÈªÉÂéüËâ≤) $50", sku: "10266/10268/10269", expiry: "2026-12-31", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/AS_Y.png", tiers: [{q:10, d:0.85}, {q:50, d:0.75}, {q:100, d:0.7}] },
            { category: "Gift Card", brand: "Ê∞∏Ê®Ç", name: "Ê∞∏Ê®Ç Â´ÅÂõçÁ¶ÆÂà∏", sku: "10420", expiry: "2026-12-31", orig: 57.5, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/wedding_gift_voucher_1_1.webp", tiers: [{q:10, d:0.8}] },
            { category: "Gift Card", brand: "LE CREUSET", name: "LE CREUSET $100Á¶ÆÂà∏", sku: "10290/10291", expiry: "‰∏çË®≠ÊúüÈôê", orig: 100, min: 1, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/le%20100.webp", tiers: [{q:1, d:0.6}] },
            { category: "Gift Card", brand: "LE CREUSET", name: "LE CREUSET $500Á¶ÆÂà∏", sku: "10293", expiry: "‰∏çË®≠ÊúüÈôê", orig: 500, min: 1, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/le%20500.webp", tiers: [{q:1, d:0.6}] },
            { category: "Gift Card", brand: "LE CREUSET", name: "LE CREUSET $1000Á¶ÆÂà∏", sku: "10294", expiry: "‰∏çË®≠ÊúüÈôê", orig: 1000, min: 1, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/le1000.webp", tiers: [{q:1, d:0.6}] },
            { category: "Gift Card", brand: "Â•áËèØ", name: "Â•áËèØ $50Á¶ÆÂà∏", sku: "10461", expiry: "2026-12-31", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/50.png", tiers: [{q:10, d:0.8}] },
            { category: "Gift Card", brand: "Â•áËèØ", name: "Â•áËèØ ÈáëÁõàÂñúÁ¶ÆÂà∏", sku: "10463", expiry: "2026-12-31", orig: 83.3, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/ÈáëÁõà.png", tiers: [{q:10, d:0.84}] },
            { category: "Gift Card", brand: "Â•áËèØ", name: "Â•áËèØ ÈáëÈõÖÂñúÁ¶ÆÂà∏", sku: "10465/10468", expiry: "2026-12-31", orig: 106.6, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/ÈáëÈõÖ.png", tiers: [{q:10, d:0.84}] },
            { category: "Gift Card", brand: "Â•áËèØ", name: "Â•áËèØ ÈáëÁ∑£ÂñúÁ¶ÆÂà∏", sku: "10467", expiry: "2026-12-31", orig: 167.6, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/ÈáëÁ∑£.png", tiers: [{q:10, d:0.84}] },
            { category: "Gift Card", brand: "Â•áËèØ", name: "Â•áËèØ ÈáëÂæ°ÂñúÁ¶ÆÂà∏", sku: "10469", expiry: "2026-12-31", orig: 434.2, min: 1, img: "https://www.bespoke-wedding.com/sites/default/files/ÈáëÂæ°.png", tiers: [{q:1, d:0.84}] },
            { category: "Favor", brand: "agn√®s b.", name: "Âπ∏ÈÅãÊõ≤Â•á(2ÂÄã)", sku: "10370", expiry: "2026-12-31", orig: 46, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/ÂõûÁ¶ÆÁ¶ÆÁâ©/Â©öÁ¶ÆÂõûÁ¶ÆÂúìÁ≠íÁ¶ÆÁõíÂπ∏ÈÅãÊõ≤Â•á(2ÂÄã).png", tiers: [{q:10, d:0.85}] },
            { category: "Favor", brand: "agn√®s b.", name: "Ê¶õÂ≠êÊú±Âè§ÂäõËÑÜÁè†(40ÂÖã)", sku: "10368", expiry: "2026-12-31", orig: 46, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/ÂõûÁ¶ÆÁ¶ÆÁâ©/Â©öÁ¶ÆÂõûÁ¶ÆÂúìÁ≠íÁ¶ÆÁõíÔºöÊ¶õÂ≠êÊú±Âè§ÂäõËÑÜÁè†%20(40ÂÖã).png", tiers: [{q:10, d:0.85}] },
            { category: "Favor", brand: "agn√®s b.", name: "ÁâáË£ùÊú±Âè§Âäõ4Áâá", sku: "10201", expiry: "2026-12-31", orig: 46, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/ÂõûÁ¶ÆÁ¶ÆÁâ©/Â©öÁ¶ÆÂõûÁ¶ÆÂúìÁ≠íÁ¶ÆÁõíÔºöÁâáË£ùÊú±Âè§Âäõ4Áâá.png", tiers: [{q:10, d:0.85}] },
            { category: "Favor", brand: "GODIVA", name: "ÈõÖËá¥Â∑ßÂÖãÂäõÈêµÁõí2È°Ü", sku: "10135", expiry: "2026-12-31", orig: 59, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/ÂõûÁ¶ÆÁ¶ÆÁâ©/goÈõÖËá¥Â∑ßÂÖãÂäõÈêµÁõí2È°ÜË£ù.png", tiers: [{q:10, d:0.85}] },
            { category: "Favor", brand: "GODIVA", name: "Áµ≤Â∏∂2È°ÜË£ù(Á≤âËóç)", sku: "10137", expiry: "2026-12-31", orig: 39, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/ÂõûÁ¶ÆÁ¶ÆÁâ©/goÈõÖËá¥Â∑ßÂÖãÂäõÁ¶ÆÁõíÈÖçÁµ≤Â∏∂2È°ÜË£ù%20(Á≤âËóç).png", tiers: [{q:10, d:0.85}] },
            { category: "Favor", brand: "GODIVA", name: "Áµ≤Â∏∂2È°ÜË£ù(Á≤âÁ¥Ö)", sku: "10136", expiry: "2026-12-31", orig: 39, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/ÂõûÁ¶ÆÁ¶ÆÁâ©/goÈõÖËá¥Â∑ßÂÖãÂäõÁ¶ÆÁõíÈÖçÁµ≤Â∏∂2È°ÜË£ù%20(Á≤âËóç).png", tiers: [{q:10, d:0.85}] },
            { category: "Favor", brand: "GODIVA", name: "Â∑ßÂÖãÂäõÁ¥ôÁõí2È°Ü(ÈáëËâ≤)", sku: "10131", expiry: "2026-12-31", orig: 39, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/ÂõûÁ¶ÆÁ¶ÆÁâ©/GoÂ∑ßÂÖãÂäõÁ¥ôÁõí2È°ÜË£ù%20(ÈáëËâ≤).png", tiers: [{q:10, d:0.85}] },
            { category: "Favor", brand: "GODIVA", name: "Â∑ßÂÖãÂäõÁ¥ôÁõí2È°Ü(Á¥ÖËâ≤)", sku: "10132", expiry: "2026-12-31", orig: 39, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/ÂõûÁ¶ÆÁ¶ÆÁâ©/GoÂ∑ßÂÖãÂäõÁ¥ôÁõí2È°ÜË£ù%20(ÈáëËâ≤).png", tiers: [{q:10, d:0.85}] },
            { category: "Favor", brand: "Lady M", name: "Â•≥ÁéãÊ£âËä±È§Ö", sku: "10388/89/90", expiry: "2026-12-31", orig: 25, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/ÂõûÁ¶ÆÁ¶ÆÁâ©/ladymb1.jpg", tiers: [{q:10, d:1.0}, {q:50, d:0.92}] },
            { category: "Favor", brand: "L.M.D.C", name: "Á¥îÈªëÊùæÈú≤Á¶ÆÁõí(2Á≤í)", sku: "10382", expiry: "2026-12-31", orig: 72, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/lmdc.png", tiers: [{q:10, d:0.85}] },
            { category: "Favor", brand: "L.M.D.C", name: "ÂøÉÊÑèÁ¶ÆÁõí(2Á≤í)", sku: "10383", expiry: "2026-12-31", orig: 72, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/LMDCÂøÉÊÑèÁ¶ÆÁõí%20(2Á≤í).png", tiers: [{q:10, d:0.85}] },
            { category: "Favor", brand: "L.M.D.C", name: "Êûú‰ªÅÊú±Âè§ÂäõÁ¶ÆÁõí(2Á≤í)", sku: "10385", expiry: "2026-12-31", orig: 72, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/LMDCÊûú‰ªÅ.png", tiers: [{q:10, d:0.85}] },
            { category: "Favor", brand: "L.M.D.C", name: "Êú±Âè§ÂäõÊ©ôÊ¢ùÁ¶ÆÁõí(Á¥Ñ15Ê¢ù)", sku: "10384", expiry: "2026-12-31", orig: 220, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/ÂõûÁ¶ÆÁ¶ÆÁâ©/lmdcÊú±Âè§ÂäõÊ©ôÊ¢ùÁ¶ÆÁõí%2050ÂÖã%20(Á¥Ñ15Ê¢ù).png", tiers: [{q:10, d:0.85}] },
            { category: "Favor", brand: "Á≥ïÈªûÊôÇÂÖâ", name: "ÂõçÁ≥ñÈõúÈå¶Ê¨æÂºè", sku: "10402", expiry: "2026-12-31", orig: 20, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Á¶ÆÂç°png/timeto.png", tiers: [{q:10, d:0.88}] },
            { category: "Favor", brand: "Ê∞∏Ê®Ç", name: "ÊúâÈ∫µÂ≠êÂõûÁ¶ÆÂ∞èÁ¶ÆÁâ©", sku: "10422", expiry: "2026-12-31", orig: 38, min: 20, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/Ê∞∏Ê®Ç%20ÊúâÈ∫µÂ≠ê%20ÂõûÁ¶ÆÂ∞èÁ¶ÆÁâ©%20.jpg", tiers: [{q:20, d:0.79}] },
            { category: "Favor", brand: "Bonne Maman", name: "ËúúÁ≥ñ30g x 60Áì∂", sku: "10424", expiry: "2027-01-01", orig: 420, min: 1, img: "https://www.bespoke-wedding.com/sites/default/files/Á¶ÆÂç°/ÂõûÁ¶ÆÁ¶ÆÁâ©/ËúúÁ≥ñ%2030g%20x%2060Áì∂.png", tiers: [{q:1, d:0.8}] }
        ];

        const App = () => {
            const [activeTab, setActiveTab] = useState('Gift Card');
            const [selectedBrand, setSelectedBrand] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [cart, setCart] = useState({});
            const [showPreview, setShowPreview] = useState(false);
            const [showBarcode, setShowBarcode] = useState(false);
            const [showHistory, setShowHistory] = useState(false);
            const [currentOrder, setCurrentOrder] = useState(null);
            const [orderHistory, setOrderHistory] = useState([]);
            const [isSubmitting, setIsSubmitting] = useState(false); // 2. Èò≤Ê≠¢ÈáçË§áÈªûÊìäÁöÑÈéñ

            const barcodeRef = useRef(null);

            useEffect(() => {
                const saved = localStorage.getItem('bw_cust_history_v7');
                if (saved) setOrderHistory(JSON.parse(saved));
            }, []);

            const getPrice = (sku, qty) => {
                const p = PRODUCT_DEFS.find(x => x.sku === sku);
                if (!p) return { price: 0 };
                const qtyToCheck = qty || p.min;
                const activeTier = [...p.tiers].sort((a,b) => b.q - a.q).find(t => qtyToCheck >= t.q);
                const discount = activeTier ? activeTier.d : 1;
                return { price: Math.round(p.orig * discount * 100) / 100 };
            };

            const cartItems = useMemo(() => 
                Object.entries(cart).map(([sku, qty]) => {
                    const def = PRODUCT_DEFS.find(p => p.sku === sku);
                    const { price } = getPrice(sku, qty);
                    return { ...def, qty, currentPrice: price };
                }), [cart]
            );

            const totalPrice = cartItems.reduce((acc, item) => acc + (item.currentPrice * item.qty), 0);
            const totalCount = Object.values(cart).reduce((a, b) => a + b, 0);

            const updateQty = (sku, delta) => {
                const def = PRODUCT_DEFS.find(p => p.sku === sku);
                setCart(prev => {
                    const cur = prev[sku] || 0;
                    let next = cur + delta;
                    if (cur === 0 && delta > 0) next = def.min;
                    else if (cur === def.min && delta < 0) next = 0;
                    const res = { ...prev };
                    if (next <= 0) delete res[sku]; else res[sku] = next;
                    return res;
                });
            };

            const handleManualQty = (sku, val) => {
                const num = parseInt(val) || 0;
                setCart(prev => {
                    const res = { ...prev };
                    if (num <= 0) delete res[sku]; else res[sku] = num;
                    return res;
                });
            };

            // 2. ÂÑ™Âåñ‰∏ãÂñÆÊµÅÁ®ãÔºöÂÖàÈ°ØÁ§∫Ê¢ùÁ¢ºÔºåËÉåÊôØÂêåÊ≠•
            const handleConfirm = async () => {
                if (isSubmitting) return; // Èò≤Ê≠¢ÈÄ£Èªû
                setIsSubmitting(true);

                const id = Math.floor(100000 + Math.random() * 900000).toString();
                const now = new Date().toLocaleString('zh-HK', { hour12: false });
                const newOrder = { 
                    id: id, 
                    total: totalPrice, 
                    date: now,
                    items: cartItems.map(i => ({ name: i.name, qty: i.qty, sku: i.sku, price: i.currentPrice }))
                };

                // ÂÖàÊõ¥Êñ∞Êú¨Âú∞ UI (Âä†Âø´ÂèçÊáâÊôÇÈñì)
                const updatedHistory = [newOrder, ...orderHistory].slice(0, 5);
                setOrderHistory(updatedHistory);
                localStorage.setItem('bw_cust_history_v7', JSON.stringify(updatedHistory));
                setCurrentOrder(newOrder);
                setShowPreview(false);
                setShowBarcode(true);
                setCart({});

                // ËÉåÊôØÂü∑Ë°åË≥áÊñôÂêåÊ≠•
                try {
                    fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(newOrder)
                    }).then(() => {
                        setIsSubmitting(false);
                    });
                } catch (e) { 
                    console.error("Sync error", e);
                    setIsSubmitting(false);
                }
            };

            useEffect(() => {
                if (showBarcode && currentOrder && barcodeRef.current) {
                    JsBarcode(barcodeRef.current, "BW-" + currentOrder.id, {
                        format: "CODE128", width: 2, height: 60, displayValue: true, fontSize: 18, margin: 10
                    });
                }
            }, [showBarcode, currentOrder]);

            return React.createElement('div', { className: "min-h-screen max-w-md mx-auto relative pb-20 bg-gray-50" },
                React.createElement('header', { className: "bg-white p-5 sticky top-0 z-30 shadow-sm rounded-b-[2rem]" },
                    React.createElement('div', { className: "flex justify-between items-center mb-4" },
                        React.createElement('div', null,
                            React.createElement('h1', { onClick: () => { setSelectedBrand(null); setSearchTerm(''); }, className: "text-2xl font-black text-rose-500 italic cursor-pointer leading-none" }, "Bespoke Mall"),
                            React.createElement('p', { className: "text-[10px] text-gray-400 font-bold mt-1" }, "ÔºàÂè™ÈôêÂ±ïÂ†¥‰∏ãÂñÆÔºâ")
                        ),
                        React.createElement('button', { onClick: () => setShowHistory(true), className: "bg-slate-100 px-4 py-2 rounded-full text-[10px] font-bold text-slate-600 shadow-inner" }, "üìã ÊàëÁöÑÁ¥ÄÈåÑ")
                    ),
                    React.createElement('input', {
                        type: "text", placeholder: "ÊêúÂ∞ãÁî¢ÂìÅ„ÄÅÂìÅÁâåÊàñ SKU...",
                        className: "w-full bg-gray-100 px-4 py-3 rounded-2xl text-sm outline-none border-2 border-transparent focus:border-rose-200",
                        value: searchTerm, onChange: e => setSearchTerm(e.target.value)
                    }),
                    !searchTerm && React.createElement('div', { className: "flex mt-4 border-b" },
                        React.createElement('button', { onClick: () => { setActiveTab('Gift Card'); setSelectedBrand(null); }, className: "flex-1 py-2 text-sm font-bold " + (activeTab === 'Gift Card' ? 'tab-active' : 'text-gray-400') }, "üí≥ Á¶ÆÂà∏"),
                        React.createElement('button', { onClick: () => { setActiveTab('Favor'); setSelectedBrand(null); }, className: "flex-1 py-2 text-sm font-bold " + (activeTab === 'Favor' ? 'tab-active' : 'text-gray-400') }, "üéÅ ÂõûÁ¶ÆÂ∞èÁ¶ÆÁâ©")
                    )
                ),
                React.createElement('main', { className: "p-4" },
                    selectedBrand || searchTerm ? 
                        React.createElement('div', { className: "animate-up" },
                            !searchTerm && React.createElement('button', { onClick: () => setSelectedBrand(null), className: "mb-4 text-rose-500 font-bold text-sm" }, "‚Üê ËøîÂõû"),
                            React.createElement('div', { className: "space-y-4" },
                                PRODUCT_DEFS.filter(p => searchTerm ? (p.name.includes(searchTerm) || p.sku.includes(searchTerm) || p.brand.toLowerCase().includes(searchTerm.toLowerCase())) : (p.brand === selectedBrand && p.category === activeTab)).map(p => {
                                    const { price } = getPrice(p.sku, cart[p.sku]);
                                    return React.createElement('div', { key: p.sku, className: "product-card bg-white p-4 border border-slate-100 flex gap-3 shadow-md items-center" },
                                        React.createElement('img', { src: p.img, className: "w-16 h-16 rounded-xl object-cover flex-shrink-0" }),
                                        React.createElement('div', { className: "flex-1 min-w-0" },
                                            React.createElement('div', { className: "text-[13px] font-black mb-1 line-clamp-1" }, p.name),
                                            React.createElement('div', { className: "text-rose-500 font-black text-base" }, "$" + price),
                                            React.createElement('div', { className: "text-[9px] text-gray-400" }, "SKU: " + p.sku)
                                        ),
                                        React.createElement('div', { className: "flex items-center gap-1 bg-gray-50 rounded-full px-1 py-0.5 flex-shrink-0" },
                                            React.createElement('button', { onClick: () => updateQty(p.sku, -1), className: "w-6 h-6 flex items-center justify-center text-gray-300 font-black text-sm" }, "‚àí"),
                                            React.createElement('input', { type: "number", value: cart[p.sku] || 0, onChange: (e) => handleManualQty(p.sku, e.target.value), className: "w-10 bg-transparent text-center font-black text-xs outline-none" }),
                                            React.createElement('button', { onClick: () => updateQty(p.sku, 1), className: "w-6 h-6 flex items-center justify-center text-rose-500 font-black text-sm" }, "+")
                                        )
                                    );
                                })
                            )
                        ) : 
                        React.createElement('div', { className: "grid grid-cols-2 gap-4 animate-up" },
                            Object.entries(BRAND_CONFIG).filter(([name]) => PRODUCT_DEFS.some(p => p.brand === name && p.category === activeTab)).map(([name, logo]) => React.createElement('div', {
                                key: name, onClick: () => setSelectedBrand(name),
                                className: "brand-card bg-white p-6 shadow-sm flex flex-col items-center justify-center h-32"
                            },
                                React.createElement('img', { src: logo, className: "w-full h-12 object-contain mb-2" }),
                                React.createElement('span', { className: "font-bold text-[10px] text-gray-400 text-center uppercase" }, name)
                            ))
                        )
                ),
                React.createElement('footer', { className: "fixed bottom-0 left-0 right-0 px-6 pb-4 pt-2 z-40 max-w-md mx-auto" },
                    React.createElement('div', { className: "bg-slate-900 px-5 py-3 flex justify-between items-center shadow-2xl rounded-[2rem] text-white" },
                        React.createElement('div', null,
                            React.createElement('div', { className: "text-[9px] text-slate-400" }, "ÂêàË®àÈáëÈ°ç"),
                            React.createElement('div', { className: "text-lg font-black text-rose-400 leading-none" }, "$" + totalPrice.toLocaleString())
                        ),
                        React.createElement('button', { 
                            disabled: totalCount === 0 || isSubmitting, onClick: () => setShowPreview(true),
                            className: "px-5 py-2 rounded-xl text-xs font-black " + (totalCount > 0 ? 'bg-rose-500 shadow-md' : 'bg-slate-800 text-slate-500')
                        }, isSubmitting ? "Ê≠£Âú®ËôïÁêÜ..." : "È†êË¶ΩË≥ºÁâ©Ëªä (" + totalCount + ")")
                    )
                ),
                showPreview && React.createElement('div', { className: "fixed inset-0 bg-black/80 z-50 flex items-end justify-center" },
                    React.createElement('div', { className: "bg-white w-full max-w-md p-8 rounded-t-[3rem] animate-up shadow-2xl" },
                        React.createElement('h3', { className: "text-2xl font-black mb-6" }, "Ê†∏Â∞çË®ÇÂñÆ"),
                        React.createElement('div', { className: "max-h-[40vh] overflow-y-auto mb-6 space-y-4 hide-scrollbar" },
                            cartItems.map(item => React.createElement('div', { key: item.sku, className: "flex justify-between items-center" },
                                React.createElement('div', { className: "flex-1 mr-4" }, 
                                    React.createElement('div', { className: "font-bold text-sm" }, item.name),
                                    React.createElement('div', { className: "text-xs text-rose-500 font-bold" }, "$" + item.currentPrice + " / ‰ª∂")
                                ),
                                React.createElement('div', { className: "flex items-center gap-2 bg-gray-100 rounded-full px-2 py-1" },
                                    React.createElement('button', { onClick: () => updateQty(item.sku, -1), className: "w-5 h-5 text-gray-400 font-bold text-sm" }, "‚àí"),
                                    React.createElement('span', { className: "w-8 text-center font-black text-xs" }, item.qty),
                                    React.createElement('button', { onClick: () => updateQty(item.sku, 1), className: "w-5 h-5 text-rose-500 font-bold text-sm" }, "+")
                                )
                            ))
                        ),
                        React.createElement('div', { className: "bg-slate-50 p-6 rounded-3xl mb-6" },
                            React.createElement('div', { className: "flex justify-between items-center mb-2" },
                                React.createElement('span', { className: "text-gray-400 font-bold text-sm" }, "Â∑≤ÈÅ∏Áî¢ÂìÅ (" + totalCount + " ‰ª∂)"),
                                React.createElement('span', { className: "text-2xl font-black text-rose-500" }, "$" + totalPrice.toLocaleString())
                            ),
                            React.createElement('p', { className: "text-[11px] text-gray-400 font-medium" }, "Ê≠§ÂÉπÈå¢ÁÇ∫Êö´ÂÆöÂÉπÊ†ºÔºå‰ªòÊ¨æÊôÇÊî∂ÈäÄÂêå‰∫ãÂ∞áÊèê‰æõÂ∞àÂ±¨ÂÑ™ÊÉ†„ÄÇ")
                        ),
                        React.createElement('button', { 
                            onClick: handleConfirm, 
                            disabled: isSubmitting,
                            className: "w-full bg-rose-500 text-white py-4 rounded-2xl font-black text-lg shadow-xl" 
                        }, isSubmitting ? "‰∏ãÂñÆ‰∏≠..." : "Á¢∫Ë™ç‰∏ãÂñÆ"),
                        React.createElement('button', { onClick: () => setShowPreview(false), className: "w-full mt-4 text-gray-400 font-bold text-sm" }, "ËøîÂõû‰øÆÊîπ")
                    )
                ),
                showBarcode && React.createElement('div', { className: "fixed inset-0 bg-black/60 z-[100] flex items-center justify-center p-6 backdrop-blur-sm" },
                    React.createElement('div', { className: "bg-white w-full max-w-xs rounded-[3rem] p-8 flex flex-col items-center animate-up shadow-2xl relative" },
                        React.createElement('button', { onClick: () => setShowBarcode(false), className: "absolute top-6 right-6 text-gray-300 text-xl" }, "‚úï"),
                        React.createElement('h2', { className: "text-lg font-black mb-6 text-slate-800" }, "ÂêëËÅ∑Âì°Âá∫Á§∫Ê¢ùÁ¢º"),
                        React.createElement('div', { className: "barcode-container" }, React.createElement('svg', { ref: barcodeRef })),
                        React.createElement('div', { className: "mt-6 text-center w-full" },
                            React.createElement('div', { className: "text-[10px] text-gray-400 uppercase font-bold" }, "Reference Number"),
                            React.createElement('div', { className: "text-2xl font-black text-rose-500" }, "BW-" + (currentOrder?.id || "")),
                            React.createElement('div', { className: "mt-3 pt-3 border-t border-dashed border-gray-200 text-left max-h-32 overflow-y-auto hide-scrollbar" },
                                currentOrder?.items.map((item, idx) => React.createElement('div', { key: idx, className: "text-[10px] text-gray-500 flex justify-between py-1" },
                                    React.createElement('span', { className: "truncate mr-2" }, item.name),
                                    React.createElement('span', { className: "font-bold flex-shrink-0" }, "x" + item.qty)
                                ))
                            )
                        ),
                        React.createElement('button', { onClick: () => setShowBarcode(false), className: "mt-6 w-full bg-slate-900 text-white py-3 rounded-2xl font-black text-sm" }, "ÂÆåÊàê")
                    )
                ),
                showHistory && React.createElement('div', { className: "fixed inset-0 bg-black/60 z-[70] flex items-center justify-center p-6 backdrop-blur-sm" },
                    React.createElement('div', { className: "bg-white w-full max-w-sm rounded-[3rem] p-8 flex flex-col animate-up shadow-2xl relative max-h-[80vh]" },
                        React.createElement('button', { onClick: () => setShowHistory(false), className: "absolute top-6 right-6 text-gray-300 text-xl" }, "‚úï"),
                        React.createElement('h2', { className: "text-xl font-black mb-6 text-slate-800" }, "Ê≠∑Âè≤Á¥ÄÈåÑ (ÊúÄËøë5Âºµ)"),
                        React.createElement('div', { className: "overflow-y-auto space-y-4 hide-scrollbar" },
                            orderHistory.length === 0 ? 
                                React.createElement('div', { className: "text-center text-gray-400 py-10 italic" }, "Êö´ÁÑ°Ê≠∑Âè≤Á¥ÄÈåÑ") :
                                orderHistory.map(ord => React.createElement('div', { key: ord.id, onClick: () => { setCurrentOrder(ord); setShowBarcode(true); }, className: "bg-gray-50 p-4 rounded-3xl border border-gray-100 flex items-center justify-between cursor-pointer" },
                                    React.createElement('div', { className: "flex-1" },
                                        React.createElement('div', { className: "flex justify-between" },
                                            React.createElement('span', { className: "font-black text-rose-500 text-sm" }, "BW-" + ord.id),
                                            React.createElement('span', { className: "text-[9px] text-gray-400" }, ord.date)
                                        ),
                                        React.createElement('div', { className: "font-bold text-sm mt-1" }, "$" + ord.total.toLocaleString())
                                    )
                                ))
                        )
                    )
                )
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
