<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bespoke Mall | æ™ºèƒ½è¨‚è³¼ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+HK:wght@300;400;500;700;900&display=swap');
        body { font-family: 'Noto Sans HK', sans-serif; -webkit-tap-highlight-color: transparent; overscroll-behavior-y: contain; }
        .brand-card { transition: all 0.2s; border-radius: 2rem; cursor: pointer; }
        .brand-card:active { transform: scale(0.95); }
        .product-card { transition: all 0.2s; border-radius: 1.5rem; }
        .animate-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .tab-active { color: #f43f5e; border-bottom: 3px solid #f43f5e; }
        /* éš±è— Input Number çš„ç®­é ­ */
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
    <script type="importmap">
    { "imports": { "react": "https://esm.sh/react@^19.2.3", "react-dom/client": "https://esm.sh/react-dom@^19.2.3/client" } }
    </script>
</head>
<body class="bg-gray-50 text-slate-900">
    <div id="root"></div>

    <script type="module">
        import React, { useState, useMemo, useRef, useEffect } from 'react';
        import ReactDOM from 'react-dom/client';

        const BRAND_CONFIG = {
            "agnÃ¨s b.": "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/AgnÃ¨s%20b.png",
            "è–å®‰å¨œ": "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/SAINT%20%20HIGH.webp",
            "GODIVA": "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/GODIVA.png",
            "æ±æµ·å ‚": "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/ç¦®å¡png/tong.png",
            "å¤ªèˆˆ": "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/å¤ªèˆˆ.jpeg",
            "é´»ç¦å ‚": "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/HungFukTong.webp",
            "Lady M": "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/ç¦®å¡png/Sugarfina%20(2).png",
            "L.M.D.C": "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/ç¦®å¡png/lmdc.png",
            "è¯å¾¡çµ": "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/HM%20Logo%20Wide-01.png",
            "ç”œå§¨å§¨": "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/auntie%20Sweet.webp",
            "æ°¸æ¨‚": "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/winglok_LOGO.webp",
            "LE CREUSET": "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/ç¦®å¡png/Copy%20of%20ç¦®å¡11.png",
            "å¥‡è¯": "https://www.bespoke-wedding.com/sites/default/files/KWLOGO.png",
            "ç³•é»æ™‚å…‰": "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/ç³•é»æ™‚å…‰.webp",
            "Bonne Maman": "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/Bonne%20Maman_%20.png"
        };

        const PRODUCT_DEFS = [
            // --- ç¦®å¡ Gift Cards ---
            { category: "Gift Card", brand: "agnÃ¨s b.", name: "agnÃ¨s b. $50ç¦®åˆ¸", sku: "20081", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/ç¦®å¡png/agnes50.png", tiers: [{q:10, d:0.85}] },
            { category: "Gift Card", brand: "agnÃ¨s b.", name: "agnÃ¨s b. $80ç¦®åˆ¸", sku: "200082", orig: 80, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/ç¦®å¡png/agnes80.png", tiers: [{q:10, d:0.85}] },
            { category: "Gift Card", brand: "agnÃ¨s b.", name: "agnÃ¨s b. $100ç¦®åˆ¸", sku: "20083", orig: 100, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/ç¦®å¡png/agnes100.png", tiers: [{q:10, d:0.85}] },
            { category: "Gift Card", brand: "è–å®‰å¨œ", name: "è–å®‰å¨œ $25ç¦®åˆ¸", sku: "10127", orig: 25, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/ç¦®å¡png/ST25.png", tiers: [{q:10, d:0.7}] },
            { category: "Gift Card", brand: "è–å®‰å¨œ", name: "è–å®‰å¨œ $50ç¦®åˆ¸", sku: "10209", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/ç¦®å¡png/ST50.png", tiers: [{q:10, d:0.7}] },
            { category: "Gift Card", brand: "GODIVA", name: "GODIVA $50 (ç²‰ç´…)", sku: "10344", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/ç¦®å¡png/godiva-p.png", tiers: [{q:10, d:0.85}] },
            { category: "Gift Card", brand: "GODIVA", name: "GODIVA $100ç¦®åˆ¸", sku: "10111", orig: 100, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/ç¦®å¡png/godiva-r.png", tiers: [{q:10, d:0.85}] },
            { category: "Gift Card", brand: "GODIVA", name: "GODIVA è»Ÿé›ªç³•/é£²å“åˆ¸", sku: "10116", orig: 59, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/ç¦®å¡png/godiva-fnb.png", tiers: [{q:10, d:0.8508}] },
            { category: "Gift Card", brand: "æ±æµ·å ‚", name: "æ±æµ·å ‚ $50 (èŠ±æ…¶)", sku: "10274", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/ç¦®å¡png/arm_f_50.png", tiers: [{q:10, d:0.79}] },
            { category: "Gift Card", brand: "å¤ªèˆˆ", name: "å¤ªèˆˆ $50é‡‘è±¬ç¦®åˆ¸", sku: "10419", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/ç¦®å¡png/taihing1.png", tiers: [{q:10, d:0.88}] },
            { category: "Gift Card", brand: "é´»ç¦å ‚", name: "è‡ªå®¶æ¹¯å¥—ç¥¨(10å¼µ)", sku: "Hung-Fuk-Tong-voucher-001", orig: 600, min: 1, img: "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/ç¦®å¡png/è‡ªå®¶æ¹¯.png", tiers: [{q:1, d:0.6583}] },
            { category: "Gift Card", brand: "Lady M", name: "Lady M US$80", sku: "10437-10443", orig: 80, min: 1, img: "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/ç¦®å¡png/Ladym80_.png", tiers: [{q:50, d:0.8}, {q:1, d:1.0}] },
            { category: "Gift Card", brand: "è¯å¾¡çµ", name: "è¯å¾¡çµ $25ç¦®åˆ¸", sku: "10446", orig: 25, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/ç¦®å¡png/hana25.png", tiers: [{q:50, d:0.85}, {q:10, d:0.88}] },
            { category: "Gift Card", brand: "LE CREUSET", name: "LC $100ç¦®åˆ¸", sku: "10290", orig: 100, min: 1, img: "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/le%20100.webp", tiers: [{q:1, d:0.6}] },
            { category: "Gift Card", brand: "å¥‡è¯", name: "å¥‡è¯ $50ç¦®åˆ¸", sku: "10461", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/50.png", tiers: [{q:10, d:0.8}] },

            // --- å›ç¦®ç¦®ç‰© Wedding Favors ---
            { category: "Favor", brand: "agnÃ¨s b.", name: "å¹¸é‹æ›²å¥‡åœ“ç­’ç¦®ç›’", sku: "10370", orig: 46, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/å›ç¦®ç¦®ç‰©/å©šç¦®å›ç¦®åœ“ç­’ç¦®ç›’å¹¸é‹æ›²å¥‡(2å€‹).png", tiers: [{q:10, d:0.85}] },
            { category: "Favor", brand: "GODIVA", name: "é›…è‡´å·§å…‹åŠ›éµç›’2é¡†", sku: "10135", orig: 59, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/å›ç¦®ç¦®ç‰©/goé›…è‡´å·§å…‹åŠ›éµç›’2é¡†è£.png", tiers: [{q:10, d:0.85}] },
            { category: "Favor", brand: "Lady M", name: "å¥³ç‹æ£‰èŠ±é¤…", sku: "10388", orig: 25, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/å›ç¦®ç¦®ç‰©/ladymb1.jpg", tiers: [{q:50, d:0.92}, {q:10, d:1.0}] },
            { category: "Favor", brand: "æ°¸æ¨‚", name: "æœ‰éºµå­å›ç¦®å°ç¦®ç‰©", sku: "10422", orig: 38, min: 20, img: "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/æ°¸æ¨‚%20æœ‰éºµå­%20å›ç¦®å°ç¦®ç‰©%20.jpg", tiers: [{q:20, d:0.79}] },
            { category: "Favor", brand: "Bonne Maman", name: "èœœç³–30g x 60ç“¶", sku: "10424", orig: 420, min: 1, img: "https://www.bespoke-wedding.com/sites/default/files/ç¦®å¡/å›ç¦®ç¦®ç‰©/èœœç³–%2030g%20x%2060ç“¶.png", tiers: [{q:1, d:0.8}] }
        ];

        const App = () => {
            const [activeTab, setActiveTab] = useState('Gift Card');
            const [selectedBrand, setSelectedBrand] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [cart, setCart] = useState({});
            const [showPreview, setShowPreview] = useState(false);
            const [showQR, setShowQR] = useState(false);
            const [currentOrder, setCurrentOrder] = useState(null);

            const qrCanvasRef = useRef(null);

            const getPrice = (sku, qty) => {
                const p = PRODUCT_DEFS.find(x => x.sku === sku);
                if (!p) return { price: 0, discount: 1 };
                const qtyToCheck = qty || p.min;
                const activeTier = p.tiers.filter(t => qtyToCheck >= t.q).sort((a,b) => b.q - a.q)[0];
                const discount = activeTier ? activeTier.d : 1;
                return { price: Math.round(p.orig * discount * 100) / 100, discount };
            };

            const cartItems = useMemo(() => 
                Object.entries(cart).map(([sku, qty]) => {
                    const def = PRODUCT_DEFS.find(p => p.sku === sku);
                    const { price, discount } = getPrice(sku, qty);
                    return { ...def, qty, currentPrice: price, discount };
                }), [cart]
            );

            const totalPrice = cartItems.reduce((acc, item) => acc + (item.currentPrice * item.qty), 0);
            const totalCount = Object.values(cart).reduce((a, b) => a + b, 0);

            // æ›´æ–°æ•¸é‡é€»è¾‘ï¼šåŠ æ¸›æŒ‰éˆ•
            const updateQty = (sku, delta) => {
                const def = PRODUCT_DEFS.find(p => p.sku === sku);
                setCart(prev => {
                    const cur = prev[sku] || 0;
                    let next = cur + delta;
                    // å¦‚æœæ˜¯å¾ 0 å¢åŠ ï¼Œç›´æ¥è¨­ç‚ºæœ€ä½è¨‚è³¼é‡
                    if (cur === 0 && delta > 0) next = def.min;
                    // å¦‚æœæ¸›å°‘å¾Œä½æ–¼æœ€ä½è¨‚è³¼é‡ï¼Œç›´æ¥æ­¸é›¶ï¼ˆå–æ¶ˆé¸å–ï¼‰
                    else if (cur === def.min && delta < 0) next = 0;
                    const res = { ...prev };
                    if (next <= 0) delete res[sku]; else res[sku] = next;
                    return res;
                });
            };

            // ç›´æ¥è¼¸å…¥æ•¸é‡é€»è¾‘
            const handleInputChange = (sku, val) => {
                const def = PRODUCT_DEFS.find(p => p.sku === sku);
                const num = parseInt(val);
                setCart(prev => {
                    const res = { ...prev };
                    if (isNaN(num) || num <= 0) {
                        delete res[sku];
                    } else {
                        // å¦‚æœè¼¸å…¥æ•¸å­—å°æ–¼æœ€ä½é‡ï¼Œå¯ä»¥æš«æ™‚è®“ç”¨æˆ¶è¼¸å…¥ï¼Œä½†åœ¨ Blur æ™‚æ ¡æ­£ï¼ˆæˆ–æ­¤è™•å¼·åˆ¶æ ¡æ­£ï¼‰
                        res[sku] = num;
                    }
                    return res;
                });
            };

            // è¼¸å…¥æ¡†å¤±å»ç„¦é»æ™‚æ ¡æ­£æœ€ä½è¨‚è³¼é‡
            const handleBlur = (sku) => {
                const def = PRODUCT_DEFS.find(p => p.sku === sku);
                const cur = cart[sku];
                if (cur && cur < def.min) {
                    setCart(prev => ({ ...prev, [sku]: def.min }));
                    alert(`${def.name} çš„æœ€ä½è¨‚è³¼é‡ç‚º ${def.min} ä»¶`);
                }
            };

            const handleConfirm = () => {
                const id = Math.floor(100000 + Math.random() * 900000).toString();
                setCurrentOrder({ id, total: totalPrice });
                setShowPreview(false);
                setShowQR(true);
            };

            useEffect(() => {
                if (showQR && currentOrder && qrCanvasRef.current) {
                    new QRious({ element: qrCanvasRef.current, value: `BW-${currentOrder.id}`, size: 240 });
                }
            }, [showQR, currentOrder]);

            return React.createElement('div', { className: "min-h-screen max-w-md mx-auto relative pb-32 bg-gray-50" },
                // Header
                React.createElement('header', { className: "bg-white p-5 sticky top-0 z-30 shadow-sm rounded-b-[2rem]" },
                    React.createElement('h1', { onClick: () => { setSelectedBrand(null); setSearchTerm(''); }, className: "text-2xl font-black text-rose-500 italic mb-4 cursor-pointer" }, "Bespoke Mall"),
                    React.createElement('input', {
                        type: "text", placeholder: "æœå°‹ç”¢å“æˆ– SKU...",
                        className: "w-full bg-gray-100 px-4 py-3 rounded-2xl text-sm outline-none border-2 border-transparent focus:border-rose-200",
                        value: searchTerm, onChange: e => setSearchTerm(e.target.value)
                    }),
                    !searchTerm && React.createElement('div', { className: "flex mt-4 border-b" },
                        React.createElement('button', { onClick: () => { setActiveTab('Gift Card'); setSelectedBrand(null); }, className: `flex-1 py-2 text-sm font-bold ${activeTab === 'Gift Card' ? 'tab-active' : 'text-gray-400'}` }, "ğŸ’³ ç¦®åˆ¸"),
                        React.createElement('button', { onClick: () => { setActiveTab('Favor'); setSelectedBrand(null); }, className: `flex-1 py-2 text-sm font-bold ${activeTab === 'Favor' ? 'tab-active' : 'text-gray-400'}` }, "ğŸ å›ç¦®ç‰©")
                    )
                ),

                // Main
                React.createElement('main', { className: "p-4" },
                    !selectedBrand && !searchTerm ? 
                        React.createElement('div', { className: "grid grid-cols-2 gap-4 animate-up" },
                            Object.entries(BRAND_CONFIG).filter(([name]) => PRODUCT_DEFS.some(p => p.brand === name && p.category === activeTab)).map(([name, logo]) => React.createElement('div', {
                                key: name, onClick: () => setSelectedBrand(name),
                                className: "brand-card bg-white p-6 shadow-sm border border-slate-100 flex flex-col items-center justify-center h-32"
                            },
                                React.createElement('img', { src: logo, className: "w-full h-12 object-contain mb-2" }),
                                React.createElement('span', { className: "font-bold text-[10px] text-gray-400 text-center" }, name)
                            ))
                        ) : 
                        React.createElement('div', { className: "animate-up" },
                            !searchTerm && React.createElement('button', { onClick: () => setSelectedBrand(null), className: "mb-4 text-rose-500 font-bold text-sm" }, "â† è¿”å›"),
                            React.createElement('div', { className: "space-y-4" },
                                PRODUCT_DEFS.filter(p => searchTerm ? (p.name.includes(searchTerm) || p.sku.includes(searchTerm)) : (p.brand === selectedBrand && p.category === activeTab)).map(p => {
                                    const { price } = getPrice(p.sku, cart[p.sku]);
                                    return React.createElement('div', { key: p.sku, className: "product-card bg-white p-4 border border-slate-100 flex gap-4 shadow-md" },
                                        React.createElement('img', { src: p.img, className: "w-20 h-20 rounded-xl object-cover" }),
                                        React.createElement('div', { className: "flex-1 min-w-0" },
                                            React.createElement('div', { className: "text-sm font-black mb-1" }, p.name),
                                            React.createElement('div', { className: "text-rose-500 font-black text-lg" }, `$${price}`),
                                            React.createElement('div', { className: "text-[10px] text-gray-400" }, `æœ€å°‘: ${p.min}`)
                                        ),
                                        // æ•¸é‡æ§åˆ¶çµ„
                                        React.createElement('div', { className: "flex flex-col items-center justify-center gap-1 bg-gray-50 rounded-2xl p-1 w-12" },
                                            React.createElement('button', { onClick: () => updateQty(p.sku, 1), className: "text-rose-500 font-black" }, "+"),
                                            // æ›´æ”¹ç‚º Input
                                            React.createElement('input', {
                                                type: "number",
                                                value: cart[p.sku] || 0,
                                                onChange: (e) => handleInputChange(p.sku, e.target.value),
                                                onBlur: () => handleBlur(p.sku),
                                                className: "w-full bg-transparent text-center font-black text-sm outline-none border-b border-transparent focus:border-rose-300",
                                                inputMode: "numeric"
                                            }),
                                            React.createElement('button', { onClick: () => updateQty(p.sku, -1), className: "text-gray-300 font-black" }, "âˆ’")
                                        )
                                    );
                                })
                            )
                        )
                ),

                // Footer
                React.createElement('footer', { className: "fixed bottom-0 left-0 right-0 p-6 z-40 max-w-md mx-auto" },
                    React.createElement('div', { className: "bg-slate-900 p-5 flex justify-between items-center shadow-2xl rounded-[2.5rem] text-white" },
                        React.createElement('div', null,
                            React.createElement('div', { className: "text-[10px] text-slate-400" }, "ä¼°ç®—é‡‘é¡"),
                            React.createElement('div', { className: "text-2xl font-black text-rose-400" }, `HK$ ${totalPrice.toLocaleString()}`)
                        ),
                        React.createElement('button', { 
                            disabled: totalCount === 0, onClick: () => setShowPreview(true),
                            className: `px-6 py-3 rounded-2xl font-black ${totalCount > 0 ? 'bg-rose-500' : 'bg-slate-800 text-slate-500'}`
                        }, `é è¦½ (${totalCount})`)
                    )
                ),

                // Preview Modal
                showPreview && React.createElement('div', { className: "fixed inset-0 bg-black/80 z-50 flex items-end" },
                    React.createElement('div', { className: "bg-white w-full max-w-md mx-auto p-8 rounded-t-[3rem] animate-up shadow-2xl" },
                        React.createElement('h3', { className: "text-2xl font-black mb-6" }, "æ ¸å°è¨‚å–®"),
                        React.createElement('div', { className: "max-h-[40vh] overflow-y-auto mb-8 space-y-4 hide-scrollbar" },
                            cartItems.map(item => React.createElement('div', { key: item.sku, className: "flex justify-between" },
                                React.createElement('div', null, 
                                    React.createElement('div', { className: "font-bold text-sm" }, item.name),
                                    React.createElement('div', { className: "text-xs text-gray-400" }, `$${item.currentPrice} x ${item.qty}`)
                                ),
                                React.createElement('span', { className: "font-black" }, `$${(item.currentPrice * item.qty).toLocaleString()}`)
                            ))
                        ),
                        React.createElement('button', { onClick: handleConfirm, className: "w-full bg-rose-500 text-white py-5 rounded-2xl font-black text-lg" }, "ä¸‹ä¸€æ­¥")
                    )
                ),

                // QR Modal
                showQR && React.createElement('div', { className: "fixed inset-0 bg-white z-[60] flex flex-col items-center justify-center p-10" },
                    React.createElement('h2', { className: "text-2xl font-black mb-6" }, "è«‹å‡ºç¤ºçµ¦åº—å“¡"),
                    React.createElement('canvas', { ref: qrCanvasRef }),
                    React.createElement('div', { className: "mt-8 text-center" },
                        React.createElement('div', { className: "text-gray-400" }, "Order Ref"),
                        React.createElement('div', { className: "text-2xl font-black" }, `BW-${currentOrder?.id}`)
                    ),
                    React.createElement('button', { onClick: () => setShowQR(false), className: "mt-10 text-rose-500 font-bold" }, "é—œé–‰")
                )
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
