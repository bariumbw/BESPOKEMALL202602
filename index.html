<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bespoke Mall | 智能訂購系統</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+HK:wght@300;400;500;700;900&display=swap');
        body { font-family: 'Noto Sans HK', sans-serif; -webkit-tap-highlight-color: transparent; overscroll-behavior-y: contain; }
        .brand-card { transition: all 0.2s; border-radius: 2rem; cursor: pointer; border: 1px solid #f1f5f9; }
        .brand-card:active { transform: scale(0.95); }
        .product-card { transition: all 0.2s; border-radius: 1.5rem; }
        .animate-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .tab-active { color: #f43f5e; border-bottom: 3px solid #f43f5e; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
    <script type="importmap">
    { "imports": { "react": "https://esm.sh/react@^19.2.3", "react-dom/client": "https://esm.sh/react-dom@^19.2.3/client" } }
    </script>
</head>
<body class="bg-gray-50 text-slate-900">
    <div id="root"></div>

    <script type="module">
        import React, { useState, useMemo, useRef, useEffect } from 'react';
        import ReactDOM from 'react-dom/client';

        const BRAND_CONFIG = {
            "agnès b.": "https://www.bespoke-wedding.com/sites/default/files/%E7%A6%AE%E5%8D%A1/Agne%CC%80s%20b.png",
            "聖安娜": "https://www.bespoke-wedding.com/sites/default/files/禮卡/SAINT%20%20HIGH.webp",
            "GODIVA": "https://www.bespoke-wedding.com/sites/default/files/禮卡/GODIVA.png",
            "東海堂": "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/tong.png",
            "太興": "https://www.bespoke-wedding.com/sites/default/files/禮卡/太興.jpeg",
            "鴻福堂": "https://www.bespoke-wedding.com/sites/default/files/禮卡/HungFukTong.webp",
            "Lady M": "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/Sugarfina%20(2).png",
            "L.M.D.C": "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/lmdc.png",
            "華御結": "https://www.bespoke-wedding.com/sites/default/files/禮卡/HM%20Logo%20Wide-01.png",
            "甜姨姨": "https://www.bespoke-wedding.com/sites/default/files/禮卡/auntie%20Sweet.webp",
            "永樂": "https://www.bespoke-wedding.com/sites/default/files/禮卡/winglok_LOGO.webp",
            "LE CREUSET": "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/Copy%20of%20禮卡11.png",
            "奇華": "https://www.bespoke-wedding.com/sites/default/files/KWLOGO.png",
            "糕點時光": "https://www.bespoke-wedding.com/sites/default/files/禮卡/糕點時光.webp",
            "Bonne Maman": "https://www.bespoke-wedding.com/sites/default/files/禮卡/Bonne%20Maman_%20.png"
        };

        const PRODUCT_DEFS = [
            // --- Gift Cards ---
            { category: "Gift Card", brand: "agnès b.", name: "agnès b. $50禮券", sku: "20081", expiry: "2026-12-31", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/agnes50.png", tiers: [{q:10, d:0.85}] },
            { category: "Gift Card", brand: "agnès b.", name: "agnès b. $80禮券", sku: "200082", expiry: "2026-12-31", orig: 80, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/agnes80.png", tiers: [{q:10, d:0.85}] },
            { category: "Gift Card", brand: "agnès b.", name: "agnès b. $100禮券", sku: "20083", expiry: "2026-12-31", orig: 100, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/agnes100.png", tiers: [{q:10, d:0.85}] },
            { category: "Gift Card", brand: "聖安娜", name: "聖安娜 $25禮券", sku: "10127", expiry: "2026-12-31", orig: 25, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/ST25.png", tiers: [{q:10, d:0.7}] },
            { category: "Gift Card", brand: "聖安娜", name: "聖安娜 $50禮券", sku: "10209", expiry: "2026-12-31", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/ST50.png", tiers: [{q:10, d:0.7}] },
            { category: "Gift Card", brand: "GODIVA", name: "GODIVA $50 (粉紅封套)", sku: "10344", expiry: "2026-12-31", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/godiva-p.png", tiers: [{q:10, d:0.85}] },
            { category: "Gift Card", brand: "GODIVA", name: "GODIVA $50 (深啡封套)", sku: "10110", expiry: "2026-12-31", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/godiva-b.png", tiers: [{q:10, d:0.85}] },
            { category: "Gift Card", brand: "GODIVA", name: "GODIVA 軟雪糕及飲品禮券", sku: "10116", expiry: "2026-08-31", orig: 59, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/godiva-fnb.png", tiers: [{q:10, d:0.8508}] },
            { category: "Gift Card", brand: "GODIVA", name: "GODIVA $100禮券", sku: "10111", expiry: "2026-12-31", orig: 100, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/godiva-r.png", tiers: [{q:10, d:0.85}] },
            { category: "Gift Card", brand: "東海堂", name: "東海堂 $50 (花慶版)", sku: "10274", expiry: "2026-12-31", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/arm_f_50.png", tiers: [{q:10, d:0.79}] },
            { category: "Gift Card", brand: "東海堂", name: "東海堂 $50 (經典版)", sku: "10107", expiry: "2026-12-31", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/ARM_O_50.png", tiers: [{q:10, d:0.79}] },
            { category: "Gift Card", brand: "東海堂", name: "東海堂 $25", sku: "10275", expiry: "2026-12-31", orig: 25, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/arm_G_25.png", tiers: [{q:10, d:0.792}] },
            { category: "Gift Card", brand: "太興", name: "太興 $50金豬禮券", sku: "10419", expiry: "2026-12-31", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/taihing1.png", tiers: [{q:10, d:0.88}] },
            { category: "Gift Card", brand: "鴻福堂", name: "鴻福堂 $50 (囍)", sku: "10278", expiry: "2026-12-31", orig: 60, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/HFT_HEI.png", tiers: [{q:10, d:0.6}] },
            { category: "Gift Card", brand: "鴻福堂", name: "鴻福堂 $50 (粉紅)", sku: "10279", expiry: "2026-12-31", orig: 60, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/HKT_P.png", tiers: [{q:10, d:0.6}] },
            { category: "Gift Card", brand: "鴻福堂", name: "自家湯套票(10張)", sku: "HFT-001", expiry: "2026-12-31", orig: 600, min: 1, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/自家湯.png", tiers: [{q:1, d:0.6583}] },
            { category: "Gift Card", brand: "鴻福堂", name: "自家涼茶套票(10張)", sku: "HFT-002", expiry: "2026-12-31", orig: 600, min: 1, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/涼茶.png", tiers: [{q:1, d:0.6583}] },
            { category: "Gift Card", brand: "鴻福堂", name: "藥製龜苓膏套票(10張)", sku: "HFT-003", expiry: "2026-12-31", orig: 600, min: 1, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/0膏.png", tiers: [{q:1, d:0.6583}] },
            { category: "Gift Card", brand: "鴻福堂", name: "自家豬腳薑醋禮券", sku: "HFT-007", expiry: "2026-12-31", orig: 60, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/HFT_PIG.png", tiers: [{q:10, d:0.766}] },
            { category: "Gift Card", brand: "Lady M", name: "Lady M US$80", sku: "10437-10443", expiry: "2026-12-31", orig: 80, min: 1, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/Ladym80_.png", tiers: [{q:1, d:1.0}, {q:50, d:0.8}] },
            { category: "Gift Card", brand: "Lady M", name: "Lady M US$150", sku: "10430-10436", expiry: "2026-12-31", orig: 150, min: 1, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡.png", tiers: [{q:1, d:1.0}, {q:50, d:0.8}] },
            { category: "Gift Card", brand: "L.M.D.C", name: "L.M.D.C $50禮券", sku: "10376/10377", expiry: "2026-12-31", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/LMDC50.png", tiers: [{q:10, d:0.88}, {q:50, d:0.84}] },
            { category: "Gift Card", brand: "L.M.D.C", name: "L.M.D.C $100禮券", sku: "10380/10378", expiry: "2026-12-31", orig: 100, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/lmdc100.png", tiers: [{q:10, d:0.88}, {q:50, d:0.85}] },
            { category: "Gift Card", brand: "L.M.D.C", name: "L.M.D.C $500禮券", sku: "10381/10379", expiry: "2026-12-31", orig: 500, min: 1, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/LMDC500.png", tiers: [{q:1, d:0.88}, {q:10, d:0.85}] },
            { category: "Gift Card", brand: "華御結", name: "華御結 $25禮券", sku: "10446/10447", expiry: "2026-12-31", orig: 25, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/hana25.png", tiers: [{q:10, d:0.88}, {q:50, d:0.85}] },
            { category: "Gift Card", brand: "華御結", name: "華御結 $50禮券", sku: "10444/10445", expiry: "2026-12-31", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/hana50.png", tiers: [{q:10, d:0.88}, {q:50, d:0.85}] },
            { category: "Gift Card", brand: "甜姨姨", name: "甜姨姨 (紅色婚慶) $50", sku: "10270/10271/10272", expiry: "2026-12-31", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/AS_R.png", tiers: [{q:10, d:0.85}, {q:50, d:0.75}, {q:100, d:0.7}] },
            { category: "Gift Card", brand: "甜姨姨", name: "甜姨姨 (淡黃原色) $50", sku: "10266/10268/10269", expiry: "2026-12-31", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/AS_Y.png", tiers: [{q:10, d:0.85}, {q:50, d:0.75}, {q:100, d:0.7}] },
            { category: "Gift Card", brand: "永樂", name: "永樂 嫁囍禮券", sku: "10420", expiry: "2026-12-31", orig: 57.5, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/wedding_gift_voucher_1_1.webp", tiers: [{q:10, d:0.8}] },
            { category: "Gift Card", brand: "LE CREUSET", name: "LE CREUSET $100禮券", sku: "10290/10291", expiry: "不設期限", orig: 100, min: 1, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/le%20100.webp", tiers: [{q:1, d:0.6}] },
            { category: "Gift Card", brand: "LE CREUSET", name: "LE CREUSET $500禮券", sku: "10293", expiry: "不設期限", orig: 500, min: 1, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/le%20500.webp", tiers: [{q:1, d:0.6}] },
            { category: "Gift Card", brand: "LE CREUSET", name: "LE CREUSET $1000禮券", sku: "10294", expiry: "不設期限", orig: 1000, min: 1, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/le1000.webp", tiers: [{q:1, d:0.6}] },
            { category: "Gift Card", brand: "奇華", name: "奇華 $50禮券", sku: "10461", expiry: "2026-12-31", orig: 50, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/50.png", tiers: [{q:10, d:0.8}] },
            { category: "Gift Card", brand: "奇華", name: "奇華 金盈喜禮券", sku: "10463", expiry: "2026-12-31", orig: 83.3, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/金盈.png", tiers: [{q:10, d:0.84}] },
            { category: "Gift Card", brand: "奇華", name: "奇華 金雅喜禮券", sku: "10465/10468", expiry: "2026-12-31", orig: 106.6, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/金雅.png", tiers: [{q:10, d:0.84}] },
            { category: "Gift Card", brand: "奇華", name: "奇華 金緣喜禮券", sku: "10467", expiry: "2026-12-31", orig: 167.6, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/金緣.png", tiers: [{q:10, d:0.84}] },
            { category: "Gift Card", brand: "奇華", name: "奇華 金御喜禮券", sku: "10469", expiry: "2026-12-31", orig: 434.2, min: 1, img: "https://www.bespoke-wedding.com/sites/default/files/金御.png", tiers: [{q:1, d:0.84}] },

            // --- Favors ---
            { category: "Favor", brand: "agnès b.", name: "幸運曲奇(2個)", sku: "10370", expiry: "2026-12-31", orig: 46, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/回禮禮物/婚禮回禮圓筒禮盒幸運曲奇(2個).png", tiers: [{q:10, d:0.85}] },
            { category: "Favor", brand: "agnès b.", name: "榛子朱古力脆珠(40克)", sku: "10368", expiry: "2026-12-31", orig: 46, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/回禮禮物/婚禮回禮圓筒禮盒：榛子朱古力脆珠%20(40克).png", tiers: [{q:10, d:0.85}] },
            { category: "Favor", brand: "agnès b.", name: "片裝朱古力4片", sku: "10201", expiry: "2026-12-31", orig: 46, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/回禮禮物/婚禮回禮圓筒禮盒：片裝朱古力4片.png", tiers: [{q:10, d:0.85}] },
            { category: "Favor", brand: "GODIVA", name: "雅致巧克力鐵盒2顆", sku: "10135", expiry: "2026-12-31", orig: 59, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/回禮禮物/go雅致巧克力鐵盒2顆裝.png", tiers: [{q:10, d:0.85}] },
            { category: "Favor", brand: "GODIVA", name: "絲帶2顆裝(粉藍)", sku: "10137", expiry: "2026-12-31", orig: 39, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/回禮禮物/go雅致巧克力禮盒配絲帶2顆裝%20(粉藍).png", tiers: [{q:10, d:0.85}] },
            { category: "Favor", brand: "GODIVA", name: "絲帶2顆裝(粉紅)", sku: "10136", expiry: "2026-12-31", orig: 39, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/回禮禮物/go雅致巧克力禮盒配絲帶2顆裝%20(粉藍).png", tiers: [{q:10, d:0.85}] },
            { category: "Favor", brand: "GODIVA", name: "巧克力紙盒2顆(金色)", sku: "10131", expiry: "2026-12-31", orig: 39, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/回禮禮物/Go巧克力紙盒2顆裝%20(金色).png", tiers: [{q:10, d:0.85}] },
            { category: "Favor", brand: "GODIVA", name: "巧克力紙盒2顆(紅色)", sku: "10132", expiry: "2026-12-31", orig: 39, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/回禮禮物/Go巧克力紙盒2顆裝%20(金色).png", tiers: [{q:10, d:0.85}] },
            { category: "Favor", brand: "Lady M", name: "女王棉花餅", sku: "10388/89/90", expiry: "2026-12-31", orig: 25, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/回禮禮物/ladymb1.jpg", tiers: [{q:10, d:1.0}, {q:50, d:0.92}] },
            { category: "Favor", brand: "L.M.D.C", name: "純黑松露禮盒(2粒)", sku: "10382", expiry: "2026-12-31", orig: 72, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/lmdc純黑松露朱古力禮盒%20(2粒)%20.png", tiers: [{q:10, d:0.85}] },
            { category: "Favor", brand: "L.M.D.C", name: "心意禮盒(2粒)", sku: "10383", expiry: "2026-12-31", orig: 72, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/LMDC心意禮盒%20(2粒).png", tiers: [{q:10, d:0.85}] },
            { category: "Favor", brand: "L.M.D.C", name: "果仁朱古力禮盒(2粒)", sku: "10385", expiry: "2026-12-31", orig: 72, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/LMDC果仁.png", tiers: [{q:10, d:0.85}] },
            { category: "Favor", brand: "L.M.D.C", name: "朱古力橙條禮盒(約15條)", sku: "10384", expiry: "2026-12-31", orig: 220, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/回禮禮物/lmdc朱古力橙條禮盒%2050克%20(約15條).png", tiers: [{q:10, d:0.85}] },
            { category: "Favor", brand: "糕點時光", name: "囍糖雜錦款式", sku: "10402", expiry: "2026-12-31", orig: 20, min: 10, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/timeto.png", tiers: [{q:10, d:0.88}] },
            { category: "Favor", brand: "永樂", name: "有麵子回禮小禮物", sku: "10422", expiry: "2026-12-31", orig: 38, min: 20, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/永樂%20有麵子%20回禮小禮物%20.jpg", tiers: [{q:20, d:0.79}] },
            { category: "Favor", brand: "Bonne Maman", name: "蜜糖30g x 60瓶", sku: "10424", expiry: "2027-01-01", orig: 420, min: 1, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/回禮禮物/蜜糖%2030g%20x%2060瓶.png", tiers: [{q:1, d:0.8}] }
        ];

        const App = () => {
            const [activeTab, setActiveTab] = useState('Gift Card');
            const [selectedBrand, setSelectedBrand] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [cart, setCart] = useState({});
            const [showPreview, setShowPreview] = useState(false);
            const [showQR, setShowQR] = useState(false);
            const [showHistory, setShowHistory] = useState(false);
            const [currentOrder, setCurrentOrder] = useState(null);
            const [orderHistory, setOrderHistory] = useState([]);

            const qrCanvasRef = useRef(null);

            useEffect(() => {
                const saved = localStorage.getItem('bw_order_history_v2');
                if (saved) setOrderHistory(JSON.parse(saved));
            }, []);

            const getPrice = (sku, qty) => {
                const p = PRODUCT_DEFS.find(x => x.sku === sku);
                if (!p) return { price: 0, discount
