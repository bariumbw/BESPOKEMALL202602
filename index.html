// 1. 品牌圖片配置
const BRAND_CONFIG = {
    "agnès b.": "https://www.bespoke-wedding.com/sites/default/files/禮卡/Agnès%20b.png",
    "聖安娜": "https://www.bespoke-wedding.com/sites/default/files/禮卡/SAINT%20%20HIGH.webp",
    "GODIVA": "https://www.bespoke-wedding.com/sites/default/files/禮卡/GODIVA.png",
    "東海堂": "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/tong.png",
    "太興": "https://www.bespoke-wedding.com/sites/default/files/禮卡/太興.jpeg",
    "鴻福堂": "https://www.bespoke-wedding.com/sites/default/files/禮卡/HungFukTong.webp",
    "Lady M": "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/Sugarfina%20(2).png",
    "L.M.D.C": "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/lmdc.png",
    "華御結": "https://www.bespoke-wedding.com/sites/default/files/禮卡/HM%20Logo%20Wide-01.png",
    "甜姨姨": "https://www.bespoke-wedding.com/sites/default/files/禮卡/auntie%20Sweet.webp",
    "永樂": "https://www.bespoke-wedding.com/sites/default/files/禮卡/winglok_LOGO.webp",
    "LE CREUSET": "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/Copy%20of%20禮卡11.png",
    "奇華": "https://www.bespoke-wedding.com/sites/default/files/KWLOGO.png"
};

// 2. 產品資訊 (更新了所有 SKU 與 圖片)
const PRODUCT_DEFS = [
    // agnès b.
    { brand: "agnès b.", name: "agnès b. $50禮券", sku: "20081", orig: 50, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/agnes50.png", tiers: [{q:10, d:0.85}] },
    { brand: "agnès b.", name: "agnès b. $80禮券", sku: "200082", orig: 80, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/agnes80.png", tiers: [{q:10, d:0.85}] },
    { brand: "agnès b.", name: "agnès b. $100禮券", sku: "20083", orig: 100, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/agnes100.png", tiers: [{q:10, d:0.85}] },
    
    // 聖安娜
    { brand: "聖安娜", name: "聖安娜 $25禮券", sku: "10127", orig: 25, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/ST25.png", tiers: [{q:10, d:0.7}] },
    { brand: "聖安娜", name: "聖安娜 $50禮券", sku: "10209", orig: 50, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/ST50.png", tiers: [{q:10, d:0.7}] },
    
    // GODIVA
    { brand: "GODIVA", name: "GODIVA $50 (粉紅封套)", sku: "10344", orig: 50, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/godiva-p.png", tiers: [{q:10, d:0.85}] },
    { brand: "GODIVA", name: "GODIVA $50 (深啡封套)", sku: "10110", orig: 50, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/godiva-b.png", tiers: [{q:10, d:0.85}] },
    { brand: "GODIVA", name: "GODIVA 軟雪糕及飲品禮券", sku: "10116", orig: 59, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/godiva-fnb.png", tiers: [{q:10, d:0.85}] },
    
    // 東海堂
    { brand: "東海堂", name: "東海堂 $50 (花慶版)", sku: "10274", orig: 50, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/arm_f_50.png", tiers: [{q:10, d:0.79}] },
    { brand: "東海堂", name: "東海堂 $50 (經典版)", sku: "10107", orig: 50, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/ARM_O_50.png", tiers: [{q:10, d:0.79}] },
    { brand: "東海堂", name: "東海堂 $25", sku: "10275", orig: 25, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/arm_G_25.png", tiers: [{q:10, d:0.792}] },

    // 鴻福堂
    { brand: "鴻福堂", name: "鴻福堂 $50 (囍)", sku: "10278", orig: 60, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/HFT_HEI.png", tiers: [{q:10, d:0.6}] },
    { brand: "鴻福堂", name: "鴻福堂 自家湯套票(10張)", sku: "HFT-001", orig: 600, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/自家湯.png", tiers: [{q:1, d:0.658}] },
    { brand: "鴻福堂", name: "自家豬腳薑醋禮券", sku: "HFT-007", orig: 68, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/HFT_PIG.png", tiers: [{q:1, d:0.676}] },

    // Lady M (層遞式)
    { brand: "Lady M", name: "Lady M $80", sku: "10437-10443", orig: 80, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/Ladym80_.png", tiers: [{q:50, d:0.8}, {q:10, d:0.9}] },
    { brand: "Lady M", name: "Lady M $150", sku: "10430-10436", orig: 150, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡.png", tiers: [{q:50, d:0.8}, {q:10, d:0.9}] },

    // L.M.D.C (層遞式)
    { brand: "L.M.D.C", name: "L.M.D.C $50禮券", sku: "10376", orig: 50, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/LMDC50.png", tiers: [{q:50, d:0.84}, {q:10, d:0.88}] },

    // 華御結 (層遞式)
    { brand: "華御結", name: "華御結 $25禮券", sku: "10446", orig: 25, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/禮卡png/hana25.png", tiers: [{q:50, d:0.85}, {q:10, d:0.88}] },

    // LE CREUSET
    { brand: "LE CREUSET", name: "LE CREUSET $100禮券", sku: "10290", orig: 100, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/le%20100.webp", tiers: [{q:1, d:0.6}] },
    { brand: "LE CREUSET", name: "LE CREUSET $1000禮券", sku: "10294", orig: 1000, img: "https://www.bespoke-wedding.com/sites/default/files/禮卡/le1000.webp", tiers: [{q:1, d:0.6}] },

    // 奇華
    { brand: "奇華", name: "奇華 $50禮券", sku: "10461", orig: 50, img: "https://www.bespoke-wedding.com/sites/default/files/50.png", tiers: [{q:10, d:0.8}] },
    { brand: "奇華", name: "奇華 金盈喜禮券", sku: "10463", orig: 83.3, img: "https://www.bespoke-wedding.com/sites/default/files/金盈.png", tiers: [{q:10, d:0.84}] }
];

// 3. 核心價錢計算邏輯
const getPriceInfo = (sku, quantity) => {
    const product = PRODUCT_DEFS.find(p => p.sku === sku);
    if (!product) return { price: 0, discount: 0 };

    // 尋找符合數量的最高階梯折扣
    const activeTier = product.tiers
        .filter(t => quantity >= t.q)
        .sort((a, b) => b.q - a.q)[0];

    const discount = activeTier ? activeTier.d : (product.tiers[product.tiers.length - 1]?.d || 1);
    const finalPrice = Math.round(product.orig * discount * 10) / 10;

    return {
        price: finalPrice,
        discount: Math.round(discount * 100)
    };
};
